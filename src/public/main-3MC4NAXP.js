import{a as de}from"./chunk-UV2D7LCB.js";import{a as ie,b as le,c as D,f as ue}from"./chunk-C7IKX3R3.js";import{a as m,b as T}from"./chunk-UFO7NE4L.js";import{a as me}from"./chunk-3YNTNXFH.js";import{n as ne,s as oe,u as se,v as ae,w as pe,x as ce}from"./chunk-OSBDGBC6.js";import{$a as C,G as u,Ha as J,J as g,K as $,M as N,Ma as X,P as z,Pa as Z,R as U,Ra as L,S as p,T as B,Wa as Q,Y as E,Z as S,_a as d,ab as q,bb as ee,c as A,ca as K,f as k,fb as y,ga as Y,gb as R,k as b,kb as M,la as j,n as w,u as f,v as x,vb as te,w as P,wb as re,xa as G,xb as F,z as h}from"./chunk-O23KAMPK.js";import{a as W}from"./chunk-2NFLSA4Y.js";var fe=()=>{let t=p(de),n=p(D);return t.isLoggedIn()?n.parseUrl("/admin"):n.parseUrl("/auth")};var he=[{path:"auth",loadComponent:()=>import("./chunk-MAP6CM4N.js"),loadChildren:()=>import("./chunk-ZW2OU5FP.js").then(t=>t.AUTH_ROUTES)},{path:"admin",loadComponent:()=>import("./chunk-6KNBS3QD.js"),loadChildren:()=>import("./chunk-PHDMOUI6.js").then(t=>t.ADMIN_ROUTES)},{path:"",loadComponent:()=>import("./chunk-GFS7TQFZ.js"),canActivate:[fe],pathMatch:"full"},{path:"**",redirectTo:"",pathMatch:"full"}];var ge=he;var ve=(t,n)=>{if(t.url.includes("/api/v1/auth/login")||t.headers.has("Authorization"))return n(t);let o=localStorage.getItem(m);if(!o)return n(t);let e=t.clone({headers:t.headers.set("Authorization",`Bearer ${o}`)});return n(e)};var be=(t,n)=>{let r=p(se),o=new ae(r),e=`${me.apiUrl}/api/v1/auth/refresh`,s=p(D);return n(t).pipe(P(i=>{if(i.status!==401)return b(()=>i);if(t.url===e||t.headers.get("x-refresh-retried"))return localStorage.removeItem(m),localStorage.removeItem(T),b(()=>i);let c=localStorage.getItem(T);return c?o.post(e,{refreshToken:c}).pipe(u(a=>{localStorage.setItem(m,a.accessToken),localStorage.setItem(T,a.refreshToken);let l=t.clone({setHeaders:{Authorization:`Bearer ${a.accessToken}`,"x-refresh-retried":"true"}});return n(l)}),P(a=>(localStorage.removeItem(m),localStorage.removeItem(T),s.navigate(["/auth"]),b(()=>a)))):(localStorage.removeItem(m),b(()=>i))}))};var H="Service workers are disabled or not supported by this browser",v=class{serviceWorker;worker;registration;events;constructor(n,r){if(this.serviceWorker=n,!n)this.worker=this.events=this.registration=new A(o=>o.error(new g(5601,!1)));else{let o=null,e=new k;this.worker=new A(l=>(o!==null&&l.next(o),e.subscribe(I=>l.next(I))));let s=()=>{let{controller:l}=n;l!==null&&(o=l,e.next(o))};n.addEventListener("controllerchange",s),s(),this.registration=this.worker.pipe(u(()=>n.getRegistration()));let i=new k;this.events=i.asObservable();let c=l=>{let{data:I}=l;I?.type&&i.next(I)};n.addEventListener("message",c),r?.get(L,null,{optional:!0})?.onDestroy(()=>{n.removeEventListener("controllerchange",s),n.removeEventListener("message",c)})}}postMessage(n,r){return new Promise(o=>{this.worker.pipe(h(1)).subscribe(e=>{e.postMessage(W({action:n},r)),o()})})}postMessageWithOperation(n,r,o){let e=this.waitForOperationCompleted(o),s=this.postMessage(n,r);return Promise.all([s,e]).then(([,i])=>i)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(n){let r;return typeof n=="string"?r=o=>o.type===n:r=o=>n.includes(o.type),this.events.pipe(x(r))}nextEventOfType(n){return this.eventsOfType(n).pipe(h(1))}waitForOperationCompleted(n){return new Promise((r,o)=>{this.eventsOfType("OPERATION_COMPLETED").pipe(x(e=>e.nonce===n),h(1),w(e=>{if(e.result!==void 0)return e.result;throw new Error(e.error)})).subscribe({next:r,error:o})})}get isEnabled(){return!!this.serviceWorker}},Me=(()=>{class t{sw;messages;notificationClicks;subscription;get isEnabled(){return this.sw.isEnabled}pushManager=null;subscriptionChanges=new k;constructor(r){if(this.sw=r,!r.isEnabled){this.messages=f,this.notificationClicks=f,this.subscription=f;return}this.messages=this.sw.eventsOfType("PUSH").pipe(w(e=>e.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(w(e=>e.data)),this.pushManager=this.sw.registration.pipe(w(e=>e.pushManager));let o=this.pushManager.pipe(u(e=>e.getSubscription()));this.subscription=new A(e=>{let s=o.subscribe(e),i=this.subscriptionChanges.subscribe(e);return()=>{s.unsubscribe(),i.unsubscribe()}})}requestSubscription(r){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(H));let o={userVisibleOnly:!0},e=this.decodeBase64(r.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),s=new Uint8Array(new ArrayBuffer(e.length));for(let i=0;i<e.length;i++)s[i]=e.charCodeAt(i);return o.applicationServerKey=s,new Promise((i,c)=>{this.pushManager.pipe(u(a=>a.subscribe(o)),h(1)).subscribe({next:a=>{this.subscriptionChanges.next(a),i(a)},error:c})})}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(H));let r=o=>{if(o===null)throw new g(5602,!1);return o.unsubscribe().then(e=>{if(!e)throw new g(5603,!1);this.subscriptionChanges.next(null)})};return new Promise((o,e)=>{this.subscription.pipe(h(1),u(r)).subscribe({next:o,error:e})})}decodeBase64(r){return atob(r)}static \u0275fac=function(o){return new(o||t)(U(v))};static \u0275prov=N({token:t,factory:t.\u0275fac})}return t})(),Te=(()=>{class t{sw;versionUpdates;unrecoverable;get isEnabled(){return this.sw.isEnabled}constructor(r){if(this.sw=r,!r.isEnabled){this.versionUpdates=f,this.unrecoverable=f;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(H));let r=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:r},r)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new g(5601,!1));let r=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:r},r)}static \u0275fac=function(o){return new(o||t)(U(v))};static \u0275prov=N({token:t,factory:t.\u0275fac})}return t})();var Ee=new z("");function _e(){let t=p(_);if(!("serviceWorker"in navigator&&t.enabled!==!1))return;let n=p(Ee),r=p(Y),o=p(L);r.runOutsideAngular(()=>{let e=navigator.serviceWorker,s=()=>e.controller?.postMessage({action:"INITIALIZE"});e.addEventListener("controllerchange",s),o.onDestroy(()=>{e.removeEventListener("controllerchange",s)})}),r.runOutsideAngular(()=>{let e,{registrationStrategy:s}=t;if(typeof s=="function")e=new Promise(i=>s().subscribe(()=>i()));else{let[i,...c]=(s||"registerWhenStable:30000").split(":");switch(i){case"registerImmediately":e=Promise.resolve();break;case"registerWithDelay":e=we(+c[0]||0);break;case"registerWhenStable":e=Promise.race([o.whenStable(),we(+c[0])]);break;default:throw new g(5600,!1)}}e.then(()=>{o.destroyed||navigator.serviceWorker.register(n,{scope:t.scope}).catch(i=>console.error($(5604,!1)))})})}function we(t){return new Promise(n=>setTimeout(n,t))}function Ie(t,n){return new v(t.enabled!==!1?navigator.serviceWorker:void 0,n)}var _=class{enabled;scope;registrationStrategy};function V(t,n={}){return B([Me,Te,{provide:Ee,useValue:t},{provide:_,useValue:n},{provide:v,useFactory:Ie,deps:[_,K]},Z(_e)])}var Se={providers:[te(),ue(ge),pe(ce([ve,be])),{provide:re,useValue:"es-ES"},V("ngsw-worker.js",{enabled:!F(),registrationStrategy:"registerWhenStable:30000"}),V("ngsw-worker.js",{enabled:!F(),registrationStrategy:"registerWhenStable:30000"})]};function Ae(t,n){if(t&1){let r=ee();d(0,"div",1),y("click",function(){E(r);let e=R();return S(e.closeSheet())}),d(1,"div",2),y("click",function(e){return E(r),S(e.stopPropagation())}),d(2,"div",3)(3,"h3",4),M(4,"Instalar aplicaci\xF3n"),C(),d(5,"button",5),y("click",function(){E(r);let e=R();return S(e.closeSheet())}),M(6,"\u2715"),C()(),d(7,"p",6),M(8,"Instala esta app en tu dispositivo para un acceso m\xE1s r\xE1pido."),C(),d(9,"button",7),y("click",function(){E(r);let e=R();return S(e.installApp())}),M(10," Instalar ahora "),C()()()}}var O=class t{title="fichas-frontend-2.0";deferredPrompt=null;installAvailable=j(!1);showInstallSheet=j(!1);constructor(){window.addEventListener("beforeinstallprompt",n=>{n.preventDefault(),this.deferredPrompt=n,this.installAvailable.set(!0),this.showInstallSheet.set(!0)})}installApp(){this.deferredPrompt&&(this.deferredPrompt.prompt(),this.deferredPrompt.userChoice.then(n=>{n.outcome==="accepted"?console.log("\u2705 Usuario instal\xF3 la app"):console.log("\u274C Usuario cancel\xF3"),this.deferredPrompt=null,this.installAvailable.set(!1),this.showInstallSheet.set(!1)}))}closeSheet(){this.showInstallSheet.set(!1)}static \u0275fac=function(r){return new(r||t)};static \u0275cmp=J({type:t,selectors:[["app-root"]],decls:2,vars:1,consts:[[1,"fixed","inset-0","bg-black/50","flex","items-end","justify-center","z-50"],[1,"fixed","inset-0","bg-black/50","flex","items-end","justify-center","z-50",3,"click"],[1,"bg-white","w-full","max-w-md","rounded-t-2xl","p-4","shadow-lg","animate-slideUp",3,"click"],[1,"flex","justify-between","items-center"],[1,"text-lg","font-semibold"],[1,"text-gray-500","hover:text-gray-800",3,"click"],[1,"text-gray-600","mt-2"],[1,"mt-4","w-full","bg-blue-600","text-white","py-2","rounded-lg","shadow","hover:bg-blue-700","transition",3,"click"]],template:function(r,o){r&1&&(q(0,"router-outlet"),X(1,Ae,11,0,"div",0)),r&2&&(G(),Q(o.installAvailable()&&o.showInstallSheet()?1:-1))},dependencies:[le,ne],encapsulation:2})};function ke(t){let n=t,r=Math.floor(Math.abs(t)),o=t.toString().replace(/^[^.]*\.?/,"").length,e=parseInt(t.toString().replace(/^[^e]*(e([-+]?\d+))?/,"$2"))||0;return n===1?1:e===0&&r!==0&&r%1e6===0&&o===0||!(e>=0&&e<=5)?4:5}var Ce=["es",[["a.\xA0m.","p.\xA0m."],void 0,void 0],void 0,[["D","L","M","X","J","V","S"],["dom","lun","mar","mi\xE9","jue","vie","s\xE1b"],["domingo","lunes","martes","mi\xE9rcoles","jueves","viernes","s\xE1bado"],["DO","LU","MA","MI","JU","VI","SA"]],void 0,[["E","F","M","A","M","J","J","A","S","O","N","D"],["ene","feb","mar","abr","may","jun","jul","ago","sept","oct","nov","dic"],["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"]],void 0,[["a. C.","d. C."],void 0,["antes de Cristo","despu\xE9s de Cristo"]],1,[6,0],["d/M/yy","d MMM y","d 'de' MMMM 'de' y","EEEE, d 'de' MMMM 'de' y"],["H:mm","H:mm:ss","H:mm:ss z","H:mm:ss (zzzz)"],["{1}, {0}",void 0,void 0,void 0],[",",".",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0\xA0%","#,##0.00\xA0\xA4","#E0"],"EUR","\u20AC","euro",{AUD:[void 0,"$"],BRL:[void 0,"R$"],BYN:[void 0,"\u0440."],CAD:[void 0,"$"],CNY:[void 0,"\xA5"],EGP:[],ESP:["\u20A7"],GBP:[void 0,"\xA3"],HKD:[void 0,"$"],ILS:[void 0,"\u20AA"],INR:[void 0,"\u20B9"],JPY:[void 0,"\xA5"],KRW:[void 0,"\u20A9"],MXN:[void 0,"$"],NZD:[void 0,"$"],PHP:[void 0,"\u20B1"],RON:[void 0,"L"],THB:["\u0E3F"],TWD:[void 0,"NT$"],USD:["US$","$"],XAF:[],XCD:[void 0,"$"],XOF:[]},"ltr",ke];oe(Ce);ie(O,Se).catch(t=>console.error(t));
