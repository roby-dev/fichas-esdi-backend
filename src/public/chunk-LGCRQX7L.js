import{a as K,b as p,c as W,d as Z,e as J,f as Q,g as X,h as Y,i as ee,j as te,k as ie,l as ne,m as le,n as oe}from"./chunk-QWVXAMFY.js";import{a as re}from"./chunk-QSNGYTAQ.js";import{a as ae,b as de}from"./chunk-LUUIMHHG.js";import"./chunk-WROVPCJX.js";import"./chunk-UFO7NE4L.js";import"./chunk-3YNTNXFH.js";import{j as R,k as $,l as A,m as z,n as w}from"./chunk-MXHFB5TN.js";import{$ as g,$a as O,Fb as P,H as I,Ja as v,Oa as _,T as f,Va as s,Ya as V,_ as C,_a as q,aa as k,ab as n,ba as L,bb as i,cb as c,db as D,hb as m,ib as x,ka as T,la as b,mb as o,na as y,nb as S,ob as u,pb as G,tb as j,ub as U,vb as B,ya as H,za as a}from"./chunk-CQFPMLQ5.js";import"./chunk-Q7L6LLAK.js";var ue=(r,e)=>({"bg-red-500/80":r,"bg-blue-500/80":e}),N=class r{child=b.required();get fullName(){return`${this.child().firstName} ${this.child().lastName}`}get statusLabel(){return this.child().isGraduated?"Egreso disponible":this.child().isCurrentlyAdmitted?"Ingreso disponible":"No aplicable"}get statusColor(){return!this.child().isGraduated&&!this.child().isCurrentlyAdmitted?"red":"blue"}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=v({type:r,selectors:[["app-child-card"]],inputs:{child:[1,"child"]},decls:27,vars:15,consts:[[1,"bg-white","p-4","space-y-2","lg:h-[200px]","flex","flex-col","justify-between"],[1,"flex","flex-col","gap-1"],[1,"flex","items-center","justify-start","text-sm","gap-4","text-gray-600","font-extralight"],[1,"flex","items-center","justify-between","gap-1"],[1,"max-w-[200px]"],[1,"text-lg","font-bold","text-gray-800"],[1,"px-2","py-1","rounded","text-white","text-center","text-xs","font-medium",3,"ngClass"],[1,"text-[13px]","md:text-sm","text-gray-500","italic","space-y-1","font-light","flex","flex-col","gap-1"],[1,""]],template:function(t,l){t&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"span"),o(5),i()(),n(6,"div")(7,"span"),o(8),U(9,"date"),i()(),n(10,"div")(11,"span"),o(12),i()()(),n(13,"div",3)(14,"div",4),c(15,"span",5),o(16),i(),n(17,"div")(18,"span",6),o(19),i()()()(),n(20,"div",7)(21,"div",8)(22,"span"),o(23),i()(),n(24,"div")(25,"span"),o(26),i()()()()),t&2&&(a(5),S(l.child().documentNumber),a(3),S(B(9,8,l.child().admissionDate,"dd MMM. yyyy","UTC")),a(4),u(" ",l.child().ageInMonths," meses "),a(4),u(" ",l.fullName," "),a(2),s("ngClass",j(12,ue,l.statusColor==="red",l.statusColor==="blue")),a(),u(" ",l.statusLabel," "),a(4),S(l.child().admissionFormatted),a(3),S(l.child().graduationFormatted))},dependencies:[z,w,R],encapsulation:2,changeDetection:0})};function F(r){return new Date(r).toISOString().split("T")[0]}function pe(r,e){r&1&&(n(0,"div",14),o(1," Documento requerido (m\xEDnimo 8 d\xEDgitos) "),i())}function he(r,e){if(r&1&&(n(0,"option",15),o(1),i()),r&2){let t=e.$implicit;s("value",t.id),a(),G("",t.localId," - ",t.name,"")}}var E=class r{fb=f(le);isLoading=b.required();child=b(null);communityHalls=b.required();saveChildEvent=T();form;ngOnInit(){this.initForm();let e=this.child();e&&this.form.patchValue({documentNumber:e.documentNumber??"",firstName:e.firstName??"",lastName:e.lastName??"",birthday:e.birthday?F(e.birthday):null,admissionDate:e.admissionDate?F(e.admissionDate):null,communityHallId:e.communityHallId??""})}initForm(){this.form=this.fb.group({documentNumber:["",[p.required,p.minLength(8),p.maxLength(8)]],firstName:["",p.required],lastName:["",p.required],birthday:[null,p.required],admissionDate:[null,p.required],communityHallId:["",p.required]})}onSubmit(){if(this.form.invalid)return;let e=this.form.value,t={documentNumber:e.documentNumber??"",firstName:e.firstName??"",lastName:e.lastName??"",birthday:e.birthday instanceof Date?e.birthday:new Date(e.birthday),admissionDate:e.admissionDate instanceof Date?e.admissionDate:new Date(e.admissionDate),communityHallId:e.communityHallId??""};this.saveChildEvent.emit(t)}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=v({type:r,selectors:[["app-child-form"]],inputs:{isLoading:[1,"isLoading"],child:[1,"child"],communityHalls:[1,"communityHalls"]},outputs:{saveChildEvent:"saveChildEvent"},decls:34,vars:6,consts:[[1,"space-y-4","p-4",3,"ngSubmit","formGroup"],[1,"block","text-sm","font-medium","text-gray-700"],["type","text","formControlName","documentNumber","maxlength","8","minlength","8",1,"mt-1","block","w-full","rounded-lg","border","border-gray-300","px-3","py-2","text-sm","focus:border-blue-500","focus:ring-blue-500"],["class","text-red-500 text-xs",4,"ngIf"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["type","text","formControlName","firstName",1,"mt-1","block","w-full","rounded-lg","border","border-gray-300","px-3","py-2","text-sm","focus:border-blue-500","focus:ring-blue-500"],["type","text","formControlName","lastName",1,"mt-1","block","w-full","rounded-lg","border","border-gray-300","px-3","py-2","text-sm","focus:border-blue-500","focus:ring-blue-500"],["type","date","formControlName","birthday",1,"mt-1","block","w-full","rounded-lg","border","border-gray-300","px-3","py-2","text-sm","focus:border-blue-500","focus:ring-blue-500"],["type","date","formControlName","admissionDate",1,"mt-1","block","w-full","rounded-lg","border","border-gray-300","px-3","py-2","text-sm","focus:border-blue-500","focus:ring-blue-500"],["formControlName","communityHallId",1,"mt-1","block","w-full","rounded-lg","border","border-gray-300","px-3","py-2","text-sm","bg-white","focus:border-blue-500","focus:ring-blue-500"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],[1,"flex","justify-end"],["type","submit",1,"rounded-lg","bg-blue-600","px-4","py-2","text-white","text-sm","font-medium","hover:bg-blue-700","disabled:opacity-50",3,"disabled"],[1,"text-red-500","text-xs"],[3,"value"]],template:function(t,l){if(t&1&&(n(0,"form",0),m("ngSubmit",function(){return l.onSubmit()}),n(1,"div")(2,"label",1),o(3,"N\xB0 Documento"),i(),c(4,"input",2),_(5,pe,2,0,"div",3),i(),n(6,"div",4)(7,"div")(8,"label",1),o(9,"Nombre"),i(),c(10,"input",5),i(),n(11,"div")(12,"label",1),o(13,"Apellido"),i(),c(14,"input",6),i()(),n(15,"div",4)(16,"div")(17,"label",1),o(18,"Fecha de nacimiento"),i(),c(19,"input",7),i(),n(20,"div")(21,"label",1),o(22,"Fecha de admisi\xF3n"),i(),c(23,"input",8),i()(),n(24,"div")(25,"label",1),o(26,"Local comunal"),i(),n(27,"select",9)(28,"option",10),o(29,"Seleccione un local comunal"),i(),_(30,he,2,3,"option",11),i()(),n(31,"div",12)(32,"button",13),o(33),i()()()),t&2){let d;s("formGroup",l.form),a(5),s("ngIf",((d=l.form.get("documentNumber"))==null?null:d.touched)&&((d=l.form.get("documentNumber"))==null?null:d.invalid)),a(25),s("ngForOf",l.communityHalls()),a(2),s("disabled",l.isLoading())("disabled",l.form.invalid),a(),u(" ",l.isLoading()?"Guardando...":"Guardar"," ")}},dependencies:[w,$,A,oe,J,ee,te,K,Y,W,Z,ie,ne,Q,X],encapsulation:2,changeDetection:0})};var fe=(r,e)=>e.id;function Ce(r,e){if(r&1){let t=D();n(0,"app-child-card",12),m("click",function(){let d=C(t).$implicit,h=x();return g(h.onSelectedChild(d))}),i()}if(r&2){let t=e.$implicit;s("child",t)}}function ge(r,e){if(r&1){let t=D();n(0,"div",11)(1,"div",13),m("click",function(){C(t);let d=x();return g(d.closeModal())}),i(),n(2,"div",14),m("click",function(d){return C(t),g(d.stopPropagation())}),n(3,"div",15)(4,"h3",16),o(5),i(),n(6,"button",17),m("click",function(){C(t);let d=x();return g(d.closeModal())}),n(7,"span",18),o(8,"Cerrar"),i(),k(),n(9,"svg",19),c(10,"path",20),i()()(),L(),n(11,"div",21)(12,"app-child-form",22),m("saveChildEvent",function(d){C(t);let h=x();return g(h.onChildSaved(d))}),i()()()()}if(r&2){let t=x();a(5),u(" ",t.selectedChild()?"Editar ni\xF1o":"Agregar ni\xF1o"," "),a(7),s("child",t.selectedChild())("communityHalls",t.communityHallState.communityHalls())("isLoading",t.isLoading())}}var M=class r{childrenService=f(ae);communityHallState=f(re);childrenState=f(de);selectedChild=y(null);isModalOpen=y(!1);isLoading=y(!1);searchTerm=y("");filteredChildren=P(()=>{let e=this.searchTerm().toLowerCase().trim();return e?this.childrenState.children().filter(t=>t.documentNumber.toLowerCase().includes(e)||t.firstName.toLowerCase().includes(e)||t.lastName.toLowerCase().includes(e)):this.childrenState.children()});onSearch(e){let t=e.target;this.searchTerm.set(t.value)}openModal(){this.isModalOpen.set(!0)}closeModal(){this.isModalOpen.set(!1),this.selectedChild.set(null)}onChildSaved(e){this.isLoading.set(!0),(this.selectedChild()?this.childrenService.updateChild(this.selectedChild().id,e):this.childrenService.createChild(e)).pipe(I(()=>this.childrenState.loadChildren())).subscribe({next:()=>{this.isLoading.set(!1),this.closeModal()},error:l=>{this.isLoading.set(!1),console.error(l)}})}onEscapePressed(e){this.isModalOpen()&&this.closeModal()}onSelectedChild(e){this.selectedChild.set(e),this.openModal()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=v({type:r,selectors:[["app-children"]],hostBindings:function(t,l){t&1&&m("keydown.escape",function(h){return l.onEscapePressed(h)},!1,H)},decls:19,vars:2,consts:[[1,"p-0","sm:p-4"],[1,"text-lg","font-semibold","mb-4"],[1,"flex","flex-col","gap-5","items-start"],[1,"w-full"],["id","search","type","text","placeholder","Buscar por nombre o documento...",1,"mt-1","block","w-full","rounded-lg","border","border-gray-300","bg-white","px-3","py-2","text-sm","focus:border-blue-500","focus:ring-blue-500",3,"input"],[1,"flex","flex-row","w-full","justify-between","items-center"],[1,"font-bold","text-white","bg-blue-500","py-1","px-2","rounded"],[1,"self-end"],[1,"bg-blue-500","text-white","px-4","py-2","rounded","hover:bg-blue-600","transition-all","duration-[250ms]",3,"click"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-4"],[1,"cursor-pointer",3,"child"],["aria-labelledby","modal-title","role","dialog","aria-modal","true",1,"fixed","inset-0","z-50","flex","items-center","justify-center"],[1,"cursor-pointer",3,"click","child"],["aria-hidden","true",1,"absolute","inset-0","bg-black/40",3,"click"],[1,"relative","z-10","w-full","max-w-3xl","mx-4","md:mx-0","bg-white","rounded-lg","shadow-lg","overflow-hidden",3,"click"],[1,"flex","items-center","justify-between","px-4","py-3","border-b"],["id","modal-title",1,"text-lg","font-medium","text-gray-900"],[1,"text-gray-500","hover:text-gray-700",3,"click"],[1,"sr-only"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"p-1"],[3,"saveChildEvent","child","communityHalls","isLoading"]],template:function(t,l){t&1&&(n(0,"div",0)(1,"h2",1),o(2,"Ni\xF1os"),i(),n(3,"div",2)(4,"div",3)(5,"input",4),m("input",function(h){return l.onSearch(h)}),i()(),n(6,"div",5)(7,"div")(8,"span"),o(9," Total de ni\xF1os: "),n(10,"span",6),o(11),i()()(),n(12,"div",7)(13,"button",8),m("click",function(){return l.openModal()}),o(14," Agregar ni\xF1o "),i()()(),n(15,"div",9),q(16,Ce,1,1,"app-child-card",10,fe),i()()(),_(18,ge,13,4,"div",11)),t&2&&(a(11),u(" ",l.filteredChildren().length," "),a(5),O(l.filteredChildren()),a(2),V(l.isModalOpen()?18:-1))},dependencies:[N,E],encapsulation:2,changeDetection:0})};export{M as default};
