import{b as B}from"./chunk-Z4WAXMB3.js";import{a as _e}from"./chunk-QTMSMTPD.js";import{a as H}from"./chunk-5TNNU5FG.js";import{a as ue}from"./chunk-Z2GVZK4R.js";import{b as le,c as N,d as O,e as se,g as me}from"./chunk-O44J2HJB.js";import{a as U}from"./chunk-QSNGYTAQ.js";import{b as j}from"./chunk-LUUIMHHG.js";import{a as fe,b as F}from"./chunk-WROVPCJX.js";import{a as ce,b as de,c as pe}from"./chunk-UFO7NE4L.js";import"./chunk-3YNTNXFH.js";import{j as A,n as y}from"./chunk-MXHFB5TN.js";import{$ as x,$a as J,A as ie,Fb as M,H as Y,J as ne,Ja as S,N as I,Oa as p,T as s,Ua as V,Va as h,Xa as oe,Ya as d,Za as P,_,_a as W,aa as v,ab as n,ba as k,bb as r,cb as f,db as g,h as Z,hb as u,ib as l,k as ee,ka as D,la as L,mb as c,na as C,nb as b,ob as E,rb as re,sb as ae,t as G,tb as q,w as te,za as a}from"./chunk-CQFPMLQ5.js";import"./chunk-Q7L6LLAK.js";var w=class t{userService=s(ue);users=C([]);user=C(null);setUser(i,e){let o={email:i,roles:e};this.user.set(o)}clearUser(){this.user.set(null)}clearUsers(){this.users.set([])}loadUsers(){return this.userService.getUsers().pipe(ne({next:i=>this.users.set(i),error:i=>console.error(i)}))}static \u0275fac=function(e){return new(e||t)};static \u0275prov=I({token:t,factory:t.\u0275fac,providedIn:"root"})};function Ce(t,i){if(t&1&&c(0),t&2){let e=l(2);E(" Comit\xE9: ",e.committeeName()," ")}}function ve(t,i){t&1&&c(0," No hay comit\xE9 seleccionado ")}function he(t,i){if(t&1&&p(0,Ce,1,1)(1,ve,1,0),t&2){let e=l();d(e.committeeName()?0:1)}}function ge(t,i){if(t&1){let e=g();n(0,"div",15)(1,"a",16),u("click",function(){_(e);let m=l();return x(m.closeDropdown())}),c(2," Configurar Comit\xE9 "),r(),n(3,"a",17),u("click",function(){_(e);let m=l();return x(m.closeDropdown())}),c(4," Configurar Locales "),r(),n(5,"button",18),u("click",function(){_(e);let m=l();return m.logout(),x(m.closeDropdown())}),c(6," Cerrar sesi\xF3n "),r()()}}var R=class t{router=s(N);committeeState=s(F);adminComitteeState=s(B);communityHallState=s(U);childrenState=s(j);authService=s(H);userState=s(w);role=M(()=>this.userState.user()?.roles.includes("admin")?"Administrador":"Usuario");userName=M(()=>this.userState.user()?.email.split("@")[0]??"");toggleSidebarEvent=D();committeeName=L();unreadNotifications=3;dropdownOpen=C(!1);toggleSidebar(){this.toggleSidebarEvent.emit()}toggleDropdown(){this.dropdownOpen.update(i=>!i)}closeDropdown(){this.dropdownOpen.set(!1)}logout(){localStorage.removeItem(ce),localStorage.removeItem(de),this.committeeState.clearCommittee(),this.userState.clearUser(),this.userState.clearUsers(),this.childrenState.clearChildren(),this.communityHallState.clearCommunityHalls(),this.adminComitteeState.clearCommittee(),this.router.navigate(["/auth"])}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=S({type:t,selectors:[["app-header"]],inputs:{committeeName:[1,"committeeName"]},outputs:{toggleSidebarEvent:"toggleSidebarEvent"},decls:21,vars:5,consts:[[1,"h-16","flex","items-center","justify-between","px-6","border-b"],[1,"flex","items-center","space-x-4"],["aria-label","Toggle sidebar",1,"text-gray-600","hover:text-gray-900","focus:outline-none","cursor-pointer",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 6h16M4 12h16M4 18h16"],[1,"text-sm","text-gray-600"],[1,"text-gray-900","font-medium"],[1,"relative",3,"keydown.escape"],["aria-label","User menu",1,"flex","items-center","focus:outline-none","cursor-pointer",3,"click"],[1,"w-8","h-8","bg-blue-500","rounded-full","flex","items-center","justify-center","text-white","font-semibold","text-sm"],[1,"hidden","md:block","ml-2","text-left"],[1,"text-sm","font-medium","text-gray-900"],[1,"text-xs","text-gray-500"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","ml-1","hidden","md:block","text-gray-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],[1,"absolute","right-0","mt-2","w-48","bg-white","rounded-md","shadow-lg","py-1","z-50","animate-fade-in"],["routerLink","/admin/committee",1,"block","px-4","py-2","text-sm","text-gray-700","hover:bg-gray-100",3,"click"],["routerLink","/admin/community-halls",1,"block","px-4","py-2","text-sm","text-gray-700","hover:bg-gray-100",3,"click"],[1,"w-full","text-left","block","px-4","py-2","text-sm","text-gray-700","hover:bg-gray-100","cursor-pointer",3,"click"]],template:function(e,o){e&1&&(n(0,"header",0)(1,"div",1)(2,"button",2),u("click",function(){return o.toggleSidebar()}),v(),n(3,"svg",3),f(4,"path",4),r()(),k(),n(5,"div",5)(6,"span",6),p(7,he,2,1),r()()(),n(8,"div",1)(9,"div",7),u("keydown.escape",function(){return o.closeDropdown()}),n(10,"button",8),u("click",function(){return o.toggleDropdown()}),n(11,"div",9),c(12),r(),n(13,"div",10)(14,"div",11),c(15),r(),n(16,"div",12),c(17),r()(),v(),n(18,"svg",13),f(19,"path",14),r()(),p(20,ge,7,0,"div",15),r()()()),e&2&&(a(7),d(o.authService.isAdmin()?-1:7),a(5),E(" ",o.userName().charAt(0)," "),a(3),b(o.userName()),a(2),b(o.role()),a(3),d(o.dropdownOpen()?20:-1))},dependencies:[y,O],encapsulation:2,changeDetection:0})};var be=t=>({"rotate-180":t}),we=()=>({exact:!0});function ye(t,i){t&1&&(n(0,"div",6),c(1,"Admin"),r())}function ke(t,i){if(t&1&&(n(0,"span",14),c(1),r()),t&2){let e=l(2).$implicit;a(),b(e.title)}}function Ee(t,i){if(t&1){let e=g();n(0,"li",10)(1,"a",11),u("click",function(){_(e);let m=l(2);return x(m.closeSidebar())}),v(),n(2,"svg",12),f(3,"path",13),r(),p(4,ke,2,1,"span",14),r()()}if(t&2){let e=l().$implicit,o=l();a(),h("routerLink",e.route),a(2),V("d",e.icon),a(),d(o.isCollapsed()?-1:4)}}function Me(t,i){if(t&1&&(n(0,"span",14),c(1),r()),t&2){let e=l(2).$implicit;a(),b(e.title)}}function Te(t,i){if(t&1&&(v(),n(0,"svg",16),f(1,"path",18),r()),t&2){let e=l(2).$implicit;h("ngClass",ae(1,be,e.expanded))}}function Ie(t,i){if(t&1){let e=g();n(0,"a",20),u("click",function(){_(e);let m=l(4);return x(m.closeSidebar())}),v(),n(1,"svg",21),f(2,"path",13),r(),k(),n(3,"span",14),c(4),r()()}if(t&2){let e=i.$implicit;h("routerLink",e.route)("routerLinkActiveOptions",re(4,we)),a(2),V("d",e.icon),a(2),b(e.title)}}function De(t,i){if(t&1&&(n(0,"div",17),W(1,Ie,5,5,"a",19,P),r()),t&2){let e=l(2).$implicit;a(),J(e.children)}}function Le(t,i){if(t&1){let e=g();n(0,"li",10)(1,"button",15),u("click",function(){_(e);let m=l().$implicit,xe=l();return x(xe.toggleSubmenu(m))}),n(2,"div",2),v(),n(3,"svg",12),f(4,"path",13),r(),p(5,Me,2,1,"span",14),r(),p(6,Te,2,3,":svg:svg",16),r(),p(7,De,3,0,"div",17),r()}if(t&2){let e=l().$implicit,o=l();a(4),V("d",e.icon),a(),d(o.isCollapsed()?-1:5),a(),d(o.isCollapsed()?-1:6),a(),d(e.expanded&&!o.isCollapsed()?7:-1)}}function Ve(t,i){if(t&1&&p(0,Ee,5,3,"li",10)(1,Le,8,4,"li",10),t&2){let e=i.$implicit;d(e.children?-1:0),a(),d(e.children?1:-1)}}function Ae(t,i){if(t&1&&(n(0,"div",9)(1,"a",22)(2,"div",23),c(3),r(),n(4,"div",14)(5,"p",24),c(6),r(),n(7,"p",25),c(8,"Ver perfil"),r()()()()),t&2){let e=l();a(3),E(" ",e.userName().charAt(0)," "),a(3),b(e.userName())}}var $=class t{isCollapsed=L(!1);userState=s(w);userName=M(()=>this.userState.user()?.email.split("@")[0]??"");toggleSidebarEvent=D();menuItems=C([{title:"Resumen",icon:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6",route:"dashboard"},{title:"Ni\xF1os",icon:"M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z",route:"children"}]);toggleSubmenu(i){i.children&&(i.expanded=!i.expanded)}closeSidebar(){this.toggleSidebarEvent.emit()}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=S({type:t,selectors:[["app-sidebar"]],inputs:{isCollapsed:[1,"isCollapsed"]},outputs:{toggleSidebarEvent:"toggleSidebarEvent"},decls:12,vars:2,consts:[[1,"h-full","w-full","flex","flex-col"],[1,"h-16","flex","items-center","px-4","border-b","border-slate-700"],[1,"flex","items-center"],[1,"flex-shrink-0","w-8","h-8","bg-blue-500","rounded","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-5","h-5","text-white"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 10V3L4 14h7v7l9-11h-7z"],[1,"ml-2","text-xl","font-semibold","text-white"],[1,"flex-1","overflow-y-auto","py-4"],[1,"space-y-1","px-2"],[1,"p-4","border-t","border-slate-700"],[1,"relative"],["routerLinkActive","bg-slate-700",1,"flex","items-center","px-2","py-2","text-sm","font-medium","rounded-md","hover:bg-slate-700","transition-colors",3,"click","routerLink"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","1.5"],[1,"ml-3"],[1,"w-full","flex","items-center","justify-between","px-2","py-2","text-sm","font-medium","rounded-md","hover:bg-slate-700","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-4","h-4","transition-transform",3,"ngClass"],[1,"mt-1","pl-3","space-y-1"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],["routerLinkActive","bg-slate-700",1,"flex","items-center","px-2","py-2","text-sm","font-medium","rounded-md","text-slate-300","hover:bg-slate-700","transition-colors",3,"routerLink","routerLinkActiveOptions"],["routerLinkActive","bg-slate-700",1,"flex","items-center","px-2","py-2","text-sm","font-medium","rounded-md","text-slate-300","hover:bg-slate-700","transition-colors",3,"click","routerLink","routerLinkActiveOptions"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-4","h-4"],["href","/profile",1,"flex","items-center"],[1,"w-8","h-8","bg-blue-500","rounded-full","flex","items-center","justify-center","text-white","font-semibold","text-sm"],[1,"text-sm","font-medium","text-white"],[1,"text-xs","text-slate-400"]],template:function(e,o){e&1&&(n(0,"aside",0)(1,"div",1)(2,"div",2)(3,"div",3),v(),n(4,"svg",4),f(5,"path",5),r()(),p(6,ye,2,0,"div",6),r()(),k(),n(7,"nav",7)(8,"ul",8),W(9,Ve,2,2,null,null,P),r()(),p(11,Ae,9,2,"div",9),r()),e&2&&(a(6),d(o.isCollapsed()?-1:6),a(3),J(o.menuItems()),a(2),d(o.isCollapsed()?-1:11))},dependencies:[y,A,O,me,se],encapsulation:2,changeDetection:0})};var z=class t{static \u0275fac=function(e){return new(e||t)};static \u0275cmp=S({type:t,selectors:[["app-loading"]],decls:3,vars:0,consts:[[1,"h-dvh","w-screen","flex","items-center","justify-center","bg-white"],[1,"text-3xl","font-bold","text-blue-500","animate-pulse","drop-shadow-lg","font-sans"]],template:function(e,o){e&1&&(n(0,"div",0)(1,"h1",1),c(2," Fichas Esdi "),r()())},encapsulation:2,changeDetection:0})};var K=class t{socket=s(_e);connect(i){this.socket.ioSocket.connected&&this.socket.disconnect(),this.socket.ioSocket.auth={token:i},this.socket.ioSocket.io.opts.reconnection=!0,this.socket.ioSocket.io.opts.reconnectionAttempts=10,this.socket.ioSocket.io.opts.reconnectionDelay=1e3,this.socket.ioSocket.io.opts.reconnectionDelayMax=5e3,this.socket.connect()}disconnect(){this.socket.ioSocket.connected&&this.socket.disconnect()}isConnected(){return this.socket.ioSocket.connected}static \u0275fac=function(e){return new(e||t)};static \u0275prov=I({token:t,factory:t.\u0275fac,providedIn:"root"})};var Ne=(t,i)=>({"w-44":t,"w-16":i}),Oe=(t,i)=>({"-translate-x-full":t,"translate-x-0":i});function He(t,i){t&1&&f(0,"app-loading")}function Fe(t,i){if(t&1){let e=g();n(0,"div",9),u("click",function(){_(e);let m=l(2);return x(m.closeMobileSidebar())}),r()}}function Ue(t,i){if(t&1){let e=g();f(0,"app-sidebar",1),n(1,"div",2),p(2,Fe,1,0,"div",3),n(3,"div",4)(4,"app-sidebar",5),u("toggleSidebarEvent",function(){_(e);let m=l();return x(m.toggleSidebar())}),r()()(),n(5,"div",6)(6,"app-header",7),u("toggleSidebarEvent",function(){_(e);let m=l();return x(m.toggleSidebar())}),r(),n(7,"main",8),f(8,"router-outlet"),r()()}if(t&2){let e,o=l();h("isCollapsed",o.isSidebarCollapsed())("ngClass",q(6,Ne,!o.isSidebarCollapsed(),o.isSidebarCollapsed())),a(2),d(o.isMobileSidebarOpen()?2:-1),a(),h("ngClass",q(9,Oe,!o.isMobileSidebarOpen(),o.isMobileSidebarOpen())),a(),h("isCollapsed",!1),a(2),h("committeeName",(e=o.committeeState.committee())==null?null:e.name)}}var X=class t{isLoading=C(!0);isSidebarCollapsed=C(!1);isMobileSidebarOpen=C(!1);authService=s(H);commmitteeService=s(fe);router=s(N);communityHallState=s(U);childrenState=s(j);webSocketService=s(K);committeeState=s(F);userState=s(w);adminCommitteeState=s(B);toggleSidebar(){typeof window<"u"&&window.matchMedia("(max-width: 767px)").matches?this.isMobileSidebarOpen.update(e=>!e):this.isSidebarCollapsed.update(e=>!e)}closeMobileSidebar(){this.isMobileSidebarOpen.set(!1)}ngOnInit(){this.isLoading.set(!0),this.loadUser(),this.connectWebSocket(),this.loadInitialData().pipe(Y(()=>this.loadCommitteeDetailsFromStorage()),ie(()=>this.isLoading.set(!1))).subscribe({next:()=>{console.log("Toda la data inicial se carg\xF3 correctamente. \u2705"),this.listenSocket()},error:i=>{console.error("Ocurri\xF3 un error durante la carga inicial:",i),this.router.navigate(["/admin/committee"])}})}loadInitialData(){return this.authService.isAdmin()?G([this.committeeState.loadAllCommittes(),this.adminCommitteeState.loadCommitteees(),this.userState.loadUsers()]):this.committeeState.loadCommittesByUser()}loadCommitteeDetailsFromStorage(){let i=localStorage.getItem(pe);return i?this.commmitteeService.getCommitteeById(i).pipe(Y(e=>(this.committeeState.setCommittee(e),G([this.communityHallState.loadCommunityHalls(),this.childrenState.loadChildren()]))),te(e=>(this.router.navigate(["/admin/committee"]),ee(()=>new Error("Error al cargar el comit\xE9 por ID"))))):(this.router.navigate(["/admin/committee"]),Z)}loadUser(){let i=this.authService.getDecodedToken();this.userState.setUser(i.email,i.roles)}connectWebSocket(){let i=localStorage.getItem("access_token");i&&this.webSocketService.connect(i)}ngOnDestroy(){this.webSocketService.disconnect()}listenSocket(){this.webSocketService.socket.on("reconnect_attempt",i=>{console.log("\u{1F504} Intentando reconectar (#",i,")")}),this.webSocketService.socket.on("reconnect_failed",()=>{console.error("\u26A0\uFE0F No se pudo reconectar")})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=S({type:t,selectors:[["admin-layout"]],decls:3,vars:3,consts:[[1,"flex","h-dvh","bg-gray-100"],[1,"hidden","md:flex","bg-slate-800","text-white","transition-all","duration-300",3,"isCollapsed","ngClass"],[1,"md:hidden"],["aria-hidden","true",1,"fixed","inset-0","z-40","bg-black/40"],[1,"fixed","inset-y-0","left-0","z-50","transform","transition-transform","duration-300","bg-slate-800",2,"width","16rem",3,"ngClass"],[1,"h-full","bg-slate-800","text-white",3,"toggleSidebarEvent","isCollapsed"],[1,"flex","flex-col","flex-1","overflow-hidden"],[1,"bg-white","shadow-sm",3,"toggleSidebarEvent","committeeName"],[1,"flex-1","overflow-y-auto","p-4"],["aria-hidden","true",1,"fixed","inset-0","z-40","bg-black/40",3,"click"]],template:function(e,o){e&1&&(n(0,"div",0),p(1,He,1,0,"app-loading")(2,Ue,9,12),r()),e&2&&(oe("overflow-hidden",o.isMobileSidebarOpen()),a(),d(o.isLoading()?1:2))},dependencies:[$,R,y,A,le,z],encapsulation:2,changeDetection:0})};export{X as default};
