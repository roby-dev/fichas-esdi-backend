import{b as he}from"./chunk-QTMSMTPD.js";import{a as me}from"./chunk-5TNNU5FG.js";import{a as se,b as ue,c as D,f as de}from"./chunk-O44J2HJB.js";import{a as m,b as T}from"./chunk-UFO7NE4L.js";import{a as fe}from"./chunk-3YNTNXFH.js";import{n as ne,s as ie,u as ae,v as pe,w as ce,x as le}from"./chunk-MXHFB5TN.js";import{$ as S,H as u,Ja as X,K as g,L as $,N,Oa as Z,Q as z,Ra as Q,S as U,T as p,Ta as L,U as B,V as K,Ya as q,_ as E,ab as d,bb as C,c as A,cb as ee,db as te,ea as Y,f as k,hb as y,ia as G,ib as R,k as b,mb as M,n as w,na as j,u as f,v as x,w as P,xb as re,yb as oe,z as h,za as J,zb as F}from"./chunk-CQFPMLQ5.js";import{a as W}from"./chunk-Q7L6LLAK.js";var ge=()=>{let t=p(me),o=p(D);return t.isLoggedIn()?o.parseUrl("/admin"):o.parseUrl("/auth")};var ve=[{path:"auth",loadComponent:()=>import("./chunk-LODA3M5I.js"),loadChildren:()=>import("./chunk-DYGUZCQP.js").then(t=>t.AUTH_ROUTES)},{path:"admin",loadComponent:()=>import("./chunk-334JNSZJ.js"),loadChildren:()=>import("./chunk-ZAL637AV.js").then(t=>t.ADMIN_ROUTES)},{path:"",loadComponent:()=>import("./chunk-JT6HLCMQ.js"),canActivate:[ge],pathMatch:"full"},{path:"**",redirectTo:"",pathMatch:"full"}];var be=ve;var we=(t,o)=>{if(t.url.includes("/api/v1/auth/login")||t.headers.has("Authorization"))return o(t);let n=localStorage.getItem(m);if(!n)return o(t);let e=t.clone({headers:t.headers.set("Authorization",`Bearer ${n}`)});return o(e)};var Ee=(t,o)=>{let r=p(ae),n=new pe(r),e=`${fe.apiUrl}/api/v1/auth/refresh`,s=p(D);return o(t).pipe(P(i=>{if(i.status!==401)return b(()=>i);if(t.url===e||t.headers.get("x-refresh-retried"))return localStorage.removeItem(m),localStorage.removeItem(T),b(()=>i);let c=localStorage.getItem(T);return c?n.post(e,{refreshToken:c}).pipe(u(a=>{localStorage.setItem(m,a.accessToken),localStorage.setItem(T,a.refreshToken);let l=t.clone({setHeaders:{Authorization:`Bearer ${a.accessToken}`,"x-refresh-retried":"true"}});return o(l)}),P(a=>(localStorage.removeItem(m),localStorage.removeItem(T),s.navigate(["/auth"]),b(()=>a)))):(localStorage.removeItem(m),b(()=>i))}))};var H="Service workers are disabled or not supported by this browser",v=class{serviceWorker;worker;registration;events;constructor(o,r){if(this.serviceWorker=o,!o)this.worker=this.events=this.registration=new A(n=>n.error(new g(5601,!1)));else{let n=null,e=new k;this.worker=new A(l=>(n!==null&&l.next(n),e.subscribe(I=>l.next(I))));let s=()=>{let{controller:l}=o;l!==null&&(n=l,e.next(n))};o.addEventListener("controllerchange",s),s(),this.registration=this.worker.pipe(u(()=>o.getRegistration()));let i=new k;this.events=i.asObservable();let c=l=>{let{data:I}=l;I?.type&&i.next(I)};o.addEventListener("message",c),r?.get(L,null,{optional:!0})?.onDestroy(()=>{o.removeEventListener("controllerchange",s),o.removeEventListener("message",c)})}}postMessage(o,r){return new Promise(n=>{this.worker.pipe(h(1)).subscribe(e=>{e.postMessage(W({action:o},r)),n()})})}postMessageWithOperation(o,r,n){let e=this.waitForOperationCompleted(n),s=this.postMessage(o,r);return Promise.all([s,e]).then(([,i])=>i)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(o){let r;return typeof o=="string"?r=n=>n.type===o:r=n=>o.includes(n.type),this.events.pipe(x(r))}nextEventOfType(o){return this.eventsOfType(o).pipe(h(1))}waitForOperationCompleted(o){return new Promise((r,n)=>{this.eventsOfType("OPERATION_COMPLETED").pipe(x(e=>e.nonce===o),h(1),w(e=>{if(e.result!==void 0)return e.result;throw new Error(e.error)})).subscribe({next:r,error:n})})}get isEnabled(){return!!this.serviceWorker}},_e=(()=>{class t{sw;messages;notificationClicks;subscription;get isEnabled(){return this.sw.isEnabled}pushManager=null;subscriptionChanges=new k;constructor(r){if(this.sw=r,!r.isEnabled){this.messages=f,this.notificationClicks=f,this.subscription=f;return}this.messages=this.sw.eventsOfType("PUSH").pipe(w(e=>e.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(w(e=>e.data)),this.pushManager=this.sw.registration.pipe(w(e=>e.pushManager));let n=this.pushManager.pipe(u(e=>e.getSubscription()));this.subscription=new A(e=>{let s=n.subscribe(e),i=this.subscriptionChanges.subscribe(e);return()=>{s.unsubscribe(),i.unsubscribe()}})}requestSubscription(r){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(H));let n={userVisibleOnly:!0},e=this.decodeBase64(r.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),s=new Uint8Array(new ArrayBuffer(e.length));for(let i=0;i<e.length;i++)s[i]=e.charCodeAt(i);return n.applicationServerKey=s,new Promise((i,c)=>{this.pushManager.pipe(u(a=>a.subscribe(n)),h(1)).subscribe({next:a=>{this.subscriptionChanges.next(a),i(a)},error:c})})}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(H));let r=n=>{if(n===null)throw new g(5602,!1);return n.unsubscribe().then(e=>{if(!e)throw new g(5603,!1);this.subscriptionChanges.next(null)})};return new Promise((n,e)=>{this.subscription.pipe(h(1),u(r)).subscribe({next:n,error:e})})}decodeBase64(r){return atob(r)}static \u0275fac=function(n){return new(n||t)(U(v))};static \u0275prov=N({token:t,factory:t.\u0275fac})}return t})(),Ie=(()=>{class t{sw;versionUpdates;unrecoverable;get isEnabled(){return this.sw.isEnabled}constructor(r){if(this.sw=r,!r.isEnabled){this.versionUpdates=f,this.unrecoverable=f;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(H));let r=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:r},r)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new g(5601,!1));let r=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:r},r)}static \u0275fac=function(n){return new(n||t)(U(v))};static \u0275prov=N({token:t,factory:t.\u0275fac})}return t})();var Ce=new z("");function Ae(){let t=p(_);if(!("serviceWorker"in navigator&&t.enabled!==!1))return;let o=p(Ce),r=p(G),n=p(L);r.runOutsideAngular(()=>{let e=navigator.serviceWorker,s=()=>e.controller?.postMessage({action:"INITIALIZE"});e.addEventListener("controllerchange",s),n.onDestroy(()=>{e.removeEventListener("controllerchange",s)})}),r.runOutsideAngular(()=>{let e,{registrationStrategy:s}=t;if(typeof s=="function")e=new Promise(i=>s().subscribe(()=>i()));else{let[i,...c]=(s||"registerWhenStable:30000").split(":");switch(i){case"registerImmediately":e=Promise.resolve();break;case"registerWithDelay":e=Se(+c[0]||0);break;case"registerWhenStable":e=Promise.race([n.whenStable(),Se(+c[0])]);break;default:throw new g(5600,!1)}}e.then(()=>{n.destroyed||navigator.serviceWorker.register(o,{scope:t.scope}).catch(i=>console.error($(5604,!1)))})})}function Se(t){return new Promise(o=>setTimeout(o,t))}function ke(t,o){return new v(t.enabled!==!1?navigator.serviceWorker:void 0,o)}var _=class{enabled;scope;registrationStrategy};function V(t,o={}){return B([_e,Ie,{provide:Ce,useValue:t},{provide:_,useValue:o},{provide:v,useFactory:ke,deps:[_,Y]},Q(Ae)])}var Re={url:"ws://localhost:3000",options:{transports:["websocket"],upgrade:!0}},ye={providers:[re(),de(be),ce(le([we,Ee])),{provide:oe,useValue:"es-ES"},V("ngsw-worker.js",{enabled:!F(),registrationStrategy:"registerWhenStable:30000"}),V("ngsw-worker.js",{enabled:!F(),registrationStrategy:"registerWhenStable:30000"}),K(he.forRoot(Re))]};function De(t,o){if(t&1){let r=te();d(0,"div",1),y("click",function(){E(r);let e=R();return S(e.closeSheet())}),d(1,"div",2),y("click",function(e){return E(r),S(e.stopPropagation())}),d(2,"div",3)(3,"h3",4),M(4,"Instalar aplicaci\xF3n"),C(),d(5,"button",5),y("click",function(){E(r);let e=R();return S(e.closeSheet())}),M(6,"\u2715"),C()(),d(7,"p",6),M(8,"Instala esta app en tu dispositivo para un acceso m\xE1s r\xE1pido."),C(),d(9,"button",7),y("click",function(){E(r);let e=R();return S(e.installApp())}),M(10," Instalar ahora "),C()()()}}var O=class t{title="fichas-frontend-2.0";deferredPrompt=null;installAvailable=j(!1);showInstallSheet=j(!1);constructor(){window.addEventListener("beforeinstallprompt",o=>{o.preventDefault(),this.deferredPrompt=o,this.installAvailable.set(!0),this.showInstallSheet.set(!0)})}installApp(){this.deferredPrompt&&(this.deferredPrompt.prompt(),this.deferredPrompt.userChoice.then(o=>{o.outcome==="accepted"?console.log("\u2705 Usuario instal\xF3 la app"):console.log("\u274C Usuario cancel\xF3"),this.deferredPrompt=null,this.installAvailable.set(!1),this.showInstallSheet.set(!1)}))}closeSheet(){this.showInstallSheet.set(!1)}static \u0275fac=function(r){return new(r||t)};static \u0275cmp=X({type:t,selectors:[["app-root"]],decls:2,vars:1,consts:[[1,"fixed","inset-0","bg-black/50","flex","items-end","justify-center","z-50"],[1,"fixed","inset-0","bg-black/50","flex","items-end","justify-center","z-50",3,"click"],[1,"bg-white","w-full","max-w-md","rounded-t-2xl","p-4","shadow-lg","animate-slideUp",3,"click"],[1,"flex","justify-between","items-center"],[1,"text-lg","font-semibold"],[1,"text-gray-500","hover:text-gray-800",3,"click"],[1,"text-gray-600","mt-2"],[1,"mt-4","w-full","bg-blue-600","text-white","py-2","rounded-lg","shadow","hover:bg-blue-700","transition",3,"click"]],template:function(r,n){r&1&&(ee(0,"router-outlet"),Z(1,De,11,0,"div",0)),r&2&&(J(),q(n.installAvailable()&&n.showInstallSheet()?1:-1))},dependencies:[ue,ne],encapsulation:2})};function Oe(t){let o=t,r=Math.floor(Math.abs(t)),n=t.toString().replace(/^[^.]*\.?/,"").length,e=parseInt(t.toString().replace(/^[^e]*(e([-+]?\d+))?/,"$2"))||0;return o===1?1:e===0&&r!==0&&r%1e6===0&&n===0||!(e>=0&&e<=5)?4:5}var Me=["es",[["a.\xA0m.","p.\xA0m."],void 0,void 0],void 0,[["D","L","M","X","J","V","S"],["dom","lun","mar","mi\xE9","jue","vie","s\xE1b"],["domingo","lunes","martes","mi\xE9rcoles","jueves","viernes","s\xE1bado"],["DO","LU","MA","MI","JU","VI","SA"]],void 0,[["E","F","M","A","M","J","J","A","S","O","N","D"],["ene","feb","mar","abr","may","jun","jul","ago","sept","oct","nov","dic"],["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"]],void 0,[["a. C.","d. C."],void 0,["antes de Cristo","despu\xE9s de Cristo"]],1,[6,0],["d/M/yy","d MMM y","d 'de' MMMM 'de' y","EEEE, d 'de' MMMM 'de' y"],["H:mm","H:mm:ss","H:mm:ss z","H:mm:ss (zzzz)"],["{1}, {0}",void 0,void 0,void 0],[",",".",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0\xA0%","#,##0.00\xA0\xA4","#E0"],"EUR","\u20AC","euro",{AUD:[void 0,"$"],BRL:[void 0,"R$"],BYN:[void 0,"\u0440."],CAD:[void 0,"$"],CNY:[void 0,"\xA5"],EGP:[],ESP:["\u20A7"],GBP:[void 0,"\xA3"],HKD:[void 0,"$"],ILS:[void 0,"\u20AA"],INR:[void 0,"\u20B9"],JPY:[void 0,"\xA5"],KRW:[void 0,"\u20A9"],MXN:[void 0,"$"],NZD:[void 0,"$"],PHP:[void 0,"\u20B1"],RON:[void 0,"L"],THB:["\u0E3F"],TWD:[void 0,"NT$"],USD:["US$","$"],XAF:[],XCD:[void 0,"$"],XOF:[]},"ltr",Oe];ie(Me);se(O,ye).catch(t=>console.error(t));
